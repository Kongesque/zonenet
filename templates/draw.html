<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZoneNet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}">
</head>

<body class="bg-bg-color text-text-color font-sans h-screen overflow-hidden flex flex-col">



    <header id="content" class="flex justify-between items-center px-2 py-2">
        <a href="{{ url_for('main') }}" class="no-underline">
            <div class="text-lg font-semibold text-text-color tracking-tight">ZoneNet</div>
        </a>
        <div class="flex items-center gap-2">


        </div>
    </header>

    <main id="content" class="flex-1 flex items-center justify-center p-4 md:p-6 overflow-hidden">
        <div class="flex flex-col md:flex-row w-full h-full gap-4 md:gap-6">

            <!-- Tools Sidebar -->
            <section
                class="card w-full md:w-[280px] shrink-0 p-4 md:p-6 flex flex-col gap-4 md:justify-between order-2 md:order-1">
                <div>
                    <h2 class="text-sm font-semibold text-text-color mb-4">Area Selection</h2>

                    <div class="space-y-4">
                        <!-- Object Class Selector -->
                        <div class="object-class">
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-300">Target Object</span>
                            </div>
                            <select id="classSelector"
                                class="w-full bg-[#1a1a1a] text-text-color border border-gray-600 rounded-lg p-2 text-sm focus:outline-none focus:border-blue-500 appearance-none">
                                {% for id, name in coco_classes|dictsort(false, 'value') %}
                                <option value="{{ id }}" {% if id==19 %}selected{% endif %}>{{ name|capitalize }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Points Slider -->
                        <div class="slider">
                            <div class="point-info flex justify-between text-sm mb-2">
                                <span class="text-gray-300">Points</span>
                                <span class="value text-text-color font-medium">4</span>
                            </div>
                            <input type="range" value="4" min="3" max="8"
                                class="w-full h-1 bg-gray-500 rounded-full appearance-none cursor-pointer accent-white">
                        </div>

                        <hr class="border-gray-500">

                        <!-- Colors -->
                        <div class="colors">
                            <label class="text-sm text-gray-300 block mb-2">Colors</label>
                            <ul class="options flex flex-wrap gap-2">
                                <li class="option bg-red-500" data-color="239,68,68"></li>
                                <li class="option selected bg-yellow-500" data-color="234,179,8"></li>
                                <li class="option bg-green-500" data-color="34,197,94"></li>
                                <li class="option bg-blue-500" data-color="59,130,246"></li>
                                <li class="option bg-purple-500" data-color="168,85,247"></li>
                            </ul>
                        </div>

                        <hr class="border-gray-500">

                        <!-- Clear Button -->
                        <button
                            class="draw w-full py-2.5 md:py-2 text-sm text-gray-300 border border-dashed border-gray-400 rounded-lg hover:border-text-color hover:text-text-color transition-all">Clear</button>
                    </div>
                </div>

                <form action="{{ url_for('submit') }}" method="post" class="mt-4 md:mt-0">
                    <input type="hidden" name="target_class" id="targetClassInput" value="19">
                    <div class="run disable">
                        <button class="process btn-primary w-full py-3" onclick="loading();">Process</button>
                    </div>
                </form>
            </section>

            <!-- Canvas Area -->
            <section
                class="flex-1 card flex items-center justify-center p-2 md:p-4 order-1 md:order-2 min-h-0 overflow-hidden">
                <img id="image" src="{{ url_for('media_file', filename='frames/' + 'frame_' + taskID + '.jpg') }}"
                    hidden>
                <canvas class="display max-w-full max-h-full rounded-lg" id="canvas"></canvas>
            </section>
        </div>
    </main>

    <footer id="content"
        class="flex flex-col md:flex-row justify-between items-center gap-2 py-4 px-4 md:px-6 border-t border-gray-500">
        <div class="flex gap-4 md:gap-6 text-sm text-gray-300">
            <p class="size-width">
                <span>Width: </span>
                <span class="value text-text-color"> - px</span>
            </p>
            <p class="size-height">
                <span>Height: </span>
                <span class="value text-text-color"> - px</span>
            </p>
        </div>
    </footer>


    <!-- Loading Screen -->
    <div id="loading"
        class="hidden fixed inset-0 z-50 bg-bg-color flex flex-col items-center justify-center h-screen w-screen">

        <p class="text-xl font-semibold text-text-color mb-2 text-center"></p>
        <span class="text-sm text-gray-400 text-center leading-relaxed mb-6"></span>

        <!-- Progress Bar -->
        <div class="w-64 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div id="progressBar" class="h-full bg-blue-500 rounded-full transition-all duration-300 ease-out"
                style="width: 0%"></div>
        </div>
        <p id="progressText" class="text-xs text-gray-500 mt-2">0%</p>
    </div>

    <div id="responseMessage"></div>

    <script src="{{url_for('static', filename='script/draw.js')}}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#loading').hide();
        });

        function loading() {
            $("header#content").hide();
            $("main#content").hide();
            $("footer#content").hide();
            $("#loading").removeClass("hidden").css("display", "flex");

            $("#loading p").text("Processing files...");
            $("#loading span").html("The process may take a moment, please<br>keep this window open.");

            // Progress Bar Animation
            let progress = 0;
            const bar = document.getElementById('progressBar');
            const text = document.getElementById('progressText');

            const interval = setInterval(() => {
                // Simulate progress with random increments
                progress += Math.random() * 2;

                // Slow down approach to 99%
                if (progress > 99) {
                    progress = 99;
                    clearInterval(interval);
                }

                bar.style.width = progress + '%';
                text.innerText = Math.round(progress) + '%';
            }, 500);
        };

        // Handle Class Selection
        const classSelector = document.getElementById('classSelector');
        const targetClassInput = document.getElementById('targetClassInput');

        if (classSelector && targetClassInput) {
            classSelector.addEventListener('change', (e) => {
                targetClassInput.value = e.target.value;
            });
        }
    </script>

</body>

</html>