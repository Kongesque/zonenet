{% extends 'base.html' %}

{% block sidebar %}
<!-- Mobile Backdrop -->
<div id="backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 hidden lg:hidden" onclick="toggleSidebar()">
</div>

<!-- Sidebar -->
<aside id="sidebar"
    class="fixed lg:relative z-50 h-full bg-background flex flex-col overflow-hidden -translate-x-full lg:translate-x-0 w-60 lg:w-60"
    data-expanded="true">

    <!-- Sidebar Content -->
    <nav class="flex-1 p-2 space-y-1 overflow-y-auto overflow-x-hidden w-60">
        <!-- Section Header -->
        <div class="px-2 py-2">
            <span class="text-sm font-medium text-sidebar-foreground whitespace-nowrap">History</span>
        </div>

        <!-- Navigation Items -->
        {% if history_jobs %}
        {% for job in history_jobs %}
        <div class="group relative flex items-center rounded-md hover:bg-sidebar-item-hover pr-2
            {% if current_taskID == job.id %}bg-sidebar-accent text-sidebar-foreground{% endif %}">
            <a href="{{ url_for('result', taskID=job.id) }}" id="title-{{ job.id }}"
                class="flex-1 block px-2 py-2 text-sm whitespace-nowrap overflow-hidden text-ellipsis
                    {% if current_taskID == job.id %}font-medium{% else %}text-muted-foreground hover:text-sidebar-foreground{% endif %}">
                {{ job.name or job.filename or 'Untitled' }}
            </a>

            <!-- 3-dot Menu Trigger -->
            <button id="menu-btn-{{ job.id }}" onclick="toggleMenu(event, '{{ job.id }}')"
                class="opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-sidebar-menu-hover text-muted-foreground transition-opacity">
                <div class="w-4 h-4 opacity-80 bg-text-color mask-icon"
                    style="--mask-url: url('{{ url_for('static', filename='img/menu_dots.svg') }}');">
                </div>
            </button>
        </div>
        {% endfor %}
        {% else %}
        <div class="px-2 py-2 text-xs text-secondary-text italic">No history yet</div>
        {% endif %}
    </nav>
</aside>
{% endblock %}

{% block content %}
<!-- Main Content -->
<main id="content"
    class="relative flex-1 flex items-center justify-center flex-col text-center mx-2 mt-0 mb-2 overflow-hidden bg-primary-color border border-primary-border rounded-md">

    <button onclick="toggleSidebar()"
        class="absolute top-4 left-4 p-1.5 rounded-md hover:bg-sidebar-accent transition-colors cursor-pointer">
        <img src="{{ url_for('static', filename='img/sidebar.svg') }}"
            class="w-5 h-5 invert dark-only-invert opacity-80">
    </button>

    <div class="mb-4">
        <h1 class="text-3xl md:text-5xl font-bold text-sidebar-foreground tracking-tight leading-tight">
            What do you want to count?
        </h1>
    </div>

    <div class="flex flex-col items-center justify-center px-4">

        <form id="uploadForm" method='POST' enctype="multipart/form-data" hidden>
            {{ form.hidden_tag() }}
            <div class="custom-file">
                {{ form.file(class_="custom-file-input", id="fileInput", accept="video/*") }}
                <label class="custom-file-label" for="customFile">New Upload file</label>
            </div>
            <input id="dummy" type="submit" name="anything_submit" value="Submit" onclick="loading();" hidden>
        </form>

        <label for="input-file" id="drop-area"
            class="w-full max-w-6xl py-6 px-64 text-center rounded-xl cursor-pointer transition-all duration-200 bg-dropzone-hover-bg border-[2px] border-dashed border-dropzone-border hover:border-dropzone-accent group">
            <div id="file-view" class="flex flex-col items-center gap-4 md:gap-5 pointer-events-none">
                <!-- Icon with accent color, Text with text-color -->
                <div class="flex items-center gap-3 transition-colors">
                    <div class="w-8 h-8 bg-dropzone-accent mask-icon"
                        style="--mask-url: url('{{ url_for('static', filename='img/upload_icon.svg') }}');">
                    </div>
                    <span class="font-bold text-xl text-text-color">Choose Files</span>
                </div>
                <p class="text-sm text-secondary-text">or drop it here</p>
                <div class="flex items-center gap-3">
                    <span
                        class="px-3 py-1 text-xs text-secondary-text border border-secondary-text rounded-full">.MP4</span>
                    <span
                        class="px-3 py-1 text-xs text-secondary-text border border-secondary-text rounded-full">.WebM</span>
                </div>
            </div>
        </label>

        <!-- Connect Camera Button -->
        <a href="{{ url_for('camera') }}"
            class="flex items-center gap-2 mt-4 px-4 py-2 text-sm text-secondary-text border border-primary-border rounded-full hover:text-text-color hover:border-text-color hover:bg-btn-hover transition-all cursor-pointer">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <span>Connect Live Camera (RTSP / Webcam)</span>
        </a>

    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="{{url_for('static', filename='js/main.js')}}"></script>
{% endblock %}