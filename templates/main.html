{% extends 'base.html' %}

{% block sidebar %}
<!-- Mobile Backdrop -->
<div id="backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 hidden lg:hidden" onclick="toggleSidebar()">
</div>

<!-- Sidebar -->
<aside id="sidebar"
    class="fixed lg:relative z-50 h-full bg-background flex flex-col overflow-hidden transition-all duration-300 ease-in-out -translate-x-full lg:translate-x-0 w-60 lg:w-0"
    data-expanded="false">

    <!-- Sidebar Content -->
    <nav class="flex-1 p-2 space-y-1 overflow-y-auto overflow-x-hidden w-60">
        <!-- Section Header -->
        <div class="px-2 py-2">
            <span class="text-sm font-medium text-sidebar-foreground whitespace-nowrap">History</span>
        </div>

        <!-- Navigation Items -->
        {% if history_jobs %}
        {% for job in history_jobs %}
        <div class="group relative flex items-center rounded-md hover:bg-sidebar-item-hover pr-2
            {% if current_taskID == job.id %}bg-sidebar-accent text-sidebar-foreground{% endif %}">
            <a href="{{ url_for('result', taskID=job.id) }}" id="title-{{ job.id }}"
                class="flex-1 block px-2 py-2 text-sm whitespace-nowrap overflow-hidden text-ellipsis
                    {% if current_taskID == job.id %}font-medium{% else %}text-muted-foreground hover:text-sidebar-foreground{% endif %}">
                {{ job.name or job.filename or 'Untitled' }}
            </a>

            <!-- 3-dot Menu Trigger -->
            <button id="menu-btn-{{ job.id }}" onclick="toggleMenu(event, '{{ job.id }}')"
                class="opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-sidebar-menu-hover text-muted-foreground transition-opacity">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
        </div>
        {% endfor %}
        {% else %}
        <div class="px-2 py-2 text-xs text-muted-foreground italic">No history yet</div>
        {% endif %}
    </nav>
</aside>
{% endblock %}

{% block content %}
<!-- Main Content -->
<main id="content"
    class="relative flex-1 flex items-center justify-center flex-col text-center mx-2 mt-0 mb-2 overflow-hidden bg-primary-color border border-primary-border rounded-md">

    <!-- Sidebar Toggle -->
    <button onclick="toggleSidebar()"
        class="absolute top-4 left-4 p-1 rounded-md hover:bg-sidebar-accent transition-colors">
        <img src="{{ url_for('static', filename='img/sidebar.svg') }}" class="w-4.5 h-4.5 invert opacity-80">
    </button>

    <div class="mb-4">
        <h1 class="text-3xl md:text-5xl font-bold text-sidebar-foreground tracking-tight leading-tight">
            What do you want to count?
        </h1>
    </div>

    <div class="flex items-center justify-center px-4">

        <form id="uploadForm" method='POST' enctype="multipart/form-data" hidden>
            {{ form.hidden_tag() }}
            <div class="custom-file">
                {{ form.file(class_="custom-file-input", id="fileInput", accept="video/*") }}
                <label class="custom-file-label" for="customFile">New Upload file</label>
            </div>
            <input id="dummy" type="submit" name="anything_submit" value="Submit" onclick="loading();" hidden>
        </form>

        <label for="input-file" id="drop-area"
            class="w-full max-w-6xl py-6 px-64 text-center rounded-xl cursor-pointer transition-all duration-200 bg-dropzone-hover-bg border-[2px] border-dashed border-dropzone-border hover:border-dropzone-accent group">
            <div id="file-view" class="flex flex-col items-center gap-4 md:gap-5">
                <!-- Icon with accent color, Text with text-color -->
                <div class="flex items-center gap-3 transition-colors">
                    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="w-8 h-8 text-dropzone-accent">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M14.0295 17.4371L14.0295 9.06538L16.0295 9.06538L16.0295 17.4371L14.0295 17.4371Z"
                            fill="currentColor" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M15.0549 6.5858L19.2071 10.738L17.7929 12.1522L15.0549 9.41423L12.317 12.1522L10.9028 10.738L15.0549 6.5858Z"
                            fill="currentColor" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M7 15.4373H9V20.4373H21V15.4373H23V22.4373H7L7 15.4373Z" fill="currentColor" />
                    </svg>
                    <span class="font-bold text-xl text-text-color">Choose Files</span>
                </div>
                <p class="text-sm text-muted-foreground">or drop it here</p>
                <div class="flex items-center gap-3">
                    <span
                        class="px-3 py-1 text-xs text-muted-foreground border border-muted-foreground rounded-full">.MP4</span>
                    <span
                        class="px-3 py-1 text-xs text-muted-foreground border border-muted-foreground rounded-full">.WebM</span>
                </div>
            </div>
        </label>

    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="{{url_for('static', filename='script/main.js')}}"></script>
{% endblock %}